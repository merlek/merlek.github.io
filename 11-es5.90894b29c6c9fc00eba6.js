function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ElCL:function(t,e,n){"use strict";n.r(e);var i,s,r,a,o=n("8Y7J"),u=function t(){_classCallCheck(this,t)},l=n("pMnS"),h=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"setCookie",value:function(t,e,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var s="expires="+i.toUTCString();document.cookie=t+"="+e+";"+s+";path=/"}},{key:"getCookie",value:function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var s=n[i];" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(e))return s.substring(e.length,s.length)}return""}}]),t}(),c=function(){function t(e,n){_classCallCheck(this,t),this.x=e,this.y=n}return _createClass(t,[{key:"equals",value:function(t){return null!=t&&this.x===t.x&&this.y===t.y}},{key:"squaredDistance",value:function(t){return Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)}},{key:"distance",value:function(t){return Math.sqrt(this.squaredDistance(t))}}]),t}(),f=function(){var t=function t(){_classCallCheck(this,t)};return t.NORTH=new c(0,-1),t.SOUTH=new c(0,1),t.EAST=new c(1,0),t.WEST=new c(-1,0),t}(),d=function(t,e){return Math.floor(Math.random()*e)+t},v=function(t){return function(e){return(e%t+t)%t}},y=function(){function t(e,n,i,s,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];_classCallCheck(this,t),this.cols=e,this.rows=n,this.moves=i,this.start=s,this.apple=r,this.snake=a}return _createClass(t,[{key:"willEat",value:function(){return this.nextHead().equals(this.apple)}},{key:"inSnake",value:function(t){return this.snake.some((function(e){return e.equals(t)}))}},{key:"willCrash",value:function(t){var e=this.nextHead();return this.inSnake(e)||t&&(t.inSnake(e)||this.snake[0]&&this.snake[0].equals(t.snake[0]))}},{key:"validMove",value:function(t){return this.moves[0].x+t.x!==0||this.moves[0].y+t.y!==0}},{key:"nextMoves",value:function(){return this.moves.length>1?this.moves.slice(1):this.moves}},{key:"nextHead",value:function(){return 0===this.snake.length?this.start:new c(v(this.cols)(this.snake[0].x+this.moves[0].x),v(this.rows)(this.snake[0].y+this.moves[0].y))}},{key:"nextSnake",value:function(t){return this.willCrash(t)?[]:this.willEat()?[this.nextHead()].concat(this.snake):[this.nextHead()].concat(this.snake.slice(0,this.snake.length-1))}},{key:"merge",value:function(e){return Object.assign(new t(this.cols,this.rows,this.moves,this.start,this.apple,this.snake),e)}},{key:"next",value:function(e,n,i,s){return new t(e,n,this.nextMoves(),this.start,i,this.nextSnake(s))}},{key:"enqueue",value:function(t){return this.validMove(t)?this.merge({moves:this.moves.concat([t])}):this}},{key:"direction",value:function(){var t=this.moves[0];return t.equals(f.NORTH)?270:t.equals(f.SOUTH)?90:t.equals(f.EAST)?0:t.equals(f.WEST)?180:null}},{key:"segments",value:function(){return this.snake.reduce((function(t,e){if(0===t.length)t.push([e]);else{var n=t[t.length-1];1===e.distance(n[n.length-1])?n.push(e):t.push([e])}return t}),[])}},{key:"isAlive",value:function(){return this.snake.length>0}}]),t}(),g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c(20,2);_classCallCheck(this,t),this.isTwoPlayers=e,this.cols=n,this.rows=i,this.snakes=s,this.apple=r,0===this.snakes.length&&(this.snakes=[this.snakeFromState(f.EAST,new c(2,2))],this.isTwoPlayers&&this.snakes.push(this.snakeFromState(f.NORTH,new c(20,20))))}return _createClass(t,[{key:"snakeFromState",value:function(t,e){return new y(this.cols,this.rows,[t],e,this.apple,[e])}},{key:"isCrash",value:function(){return this.snakes.reduce((function(t,e){return t||!e.isAlive()}),!1)}},{key:"willEat",value:function(){return this.snakes.reduce((function(t,e){return t||e.willEat()}),!1)}},{key:"nextApple",value:function(){if(this.willEat()){var t;do{t=this.snakes.reduce((function(t,e){return e.inSnake(t)?null:t}),this.rndPos())}while(!t);return t}return this.apple}},{key:"nextSnakes",value:function(){var t=this;return this.snakes.map((function(e,n,i){return e.next(t.cols,t.rows,t.apple,i.length>1?i[(n+1)%i.length]:null)}))}},{key:"rndPos",value:function(){return new c(d(0,this.cols-1),d(0,this.rows-1))}},{key:"merge",value:function(e){return Object.assign(new t,this,e)}},{key:"next",value:function(){return new t(this.isTwoPlayers,this.cols,this.rows,this.nextSnakes(),this.nextApple())}},{key:"enqueue",value:function(t,e){var n=this;return t%=this.snakes.length,this.merge({snakes:this.snakes.map((function(i,s){return s===t?n.snakes[t].enqueue(e):i}))})}}]),t}(),k=function(){function t(e,n){_classCallCheck(this,t),this.canvas=e,this.grid=n,this.ctx=e.getContext("2d")}return _createClass(t,[{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"x",value:function(t){return Math.round(t*this.canvas.width/this.grid.cols)}},{key:"y",value:function(t){return Math.round(t*this.canvas.height/this.grid.rows)}}]),t}(),p=((i=function(t){function e(t,n){var i;return _classCallCheck(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.ctx;t.save(),t.fillStyle=e.BACKGROUND_COLOR,t.fillRect(0,0,i.canvas.width,i.canvas.height),t.restore()},i}return _inherits(e,t),e}(k)).BACKGROUND_COLOR="#232323",i),w=function(){var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"drawRoundedRect",value:function(t,e,n,i,s){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if("number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else for(var u={tl:0,tr:0,br:0,bl:0},l=0,h=Object.keys(u);l<h.length;l++){var c=h[l];r[c]=r[c]||u[c]}t.save(),t.beginPath(),t.moveTo(e+r.tl,n),t.lineTo(e+i-r.tr,n),t.quadraticCurveTo(e+i,n,e+i,n+r.tr),t.lineTo(e+i,n+s-r.br),t.quadraticCurveTo(e+i,n+s,e+i-r.br,n+s),t.lineTo(e+r.bl,n+s),t.quadraticCurveTo(e,n+s,e,n+s-r.bl),t.lineTo(e,n+r.tl),t.quadraticCurveTo(e,n,e+r.tl,n),t.closePath(),a&&t.fill(),o&&t.stroke(),t.restore()}}]),t}();return t.drawButton=function(e){return function(n){var i=n.x,s=n.y,r=n.width,a=n.height,o=n.radius,u=n.fillStyle,l=n.strokeStyle,h=n.hoverStyle,c=n.text,f=n.fontSize,d=n.textStyle,v=n.state;e.save(),"hover"===v&&h?e.fillStyle=h:u&&(e.fillStyle=u),l&&(e.lineWidth=2,e.strokeStyle=l),t.drawRoundedRect(e,i,s,r,a,o,!0,null!=l),t.drawText(e,c,i+r/2,s+a/2,f,d),e.restore()}},t.drawText=function(e,n,i,s,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"center",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"middle";e.save(),e.fillStyle=a,e.font=t.getFont(r),e.textAlign=o,e.textBaseline=u,e.fillText(n,i,s),e.restore()},t.getFont=function(t){return t+'px Montserrat, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},t.addButtonClickEventListener=function(e,n){var i=t.getMousePos(e),s=function(e){var s=i(e);n.forEach((function(n){n.enabled&&t.isIntersect(s,n)&&n.onClick(e)}))};return e.addEventListener("click",s),{type:"click",function:s}},t.addButtonHoverEventListener=function(e,n){var i=t.getMousePos(e),s=function(s){var r=i(s),a=!1;n.forEach((function(e){e.enabled&&t.isIntersect(r,e)?(e.state="hover",a=!0):e.state&&(e.state=void 0)})),e.style.cursor=a?"pointer":"default"};return e.addEventListener("mousemove",s),{type:"mousemove",function:s}},t.getMousePos=function(t){return function(e){var n=t.getBoundingClientRect();return{x:(e.clientX-n.left)/(n.right-n.left)*t.width,y:(e.clientY-n.top)/(n.bottom-n.top)*t.height}}},t.isIntersect=function(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y<e.y+e.height&&t.y>e.y},t}(),m=function(t){function e(t,n,i,s){var r;_classCallCheck(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).buttons=[],r.eventListeners=[],r.draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.ctx;r.clear(),t.save(),r.buttons.forEach(w.drawButton(t)),t.restore()};var a=t.width/4,o=t.height/8,u=t.width/2-a/2,l=t.height/2-o/2;return r.buttons.push({x:u,y:l,width:a,height:o,radius:5,fillStyle:"#005FA1",hoverStyle:"#00487b",text:"Paused",fontSize:r.y(1),textStyle:"white",enabled:!0,onClick:function(){i()}},{x:u,y:l+2*o,width:a,height:o,radius:5,fillStyle:"#005fa1",hoverStyle:"#00487b",text:"Two Players",fontSize:.8*r.y(1),textStyle:"rgba(255, 255, 255, 1)",enabled:!0,onClick:function(){s()}}),r.addEventListeners(),r}return _inherits(e,t),_createClass(e,[{key:"addEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.buttons;return this.eventListeners.push(w.addButtonClickEventListener(t,e),w.addButtonHoverEventListener(t,e))}},{key:"removeEventListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.eventListeners;e.forEach((function(e){t.removeEventListener(e.type,e.function)}))}},{key:"enableButtons",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buttons;t.forEach((function(t){return t.enabled=!0}))}},{key:"disableButtons",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buttons;t.forEach((function(t){return t.enabled=!1}))}},{key:"show",value:function(){this.enableButtons(),this.draw()}},{key:"hide",value:function(){this.clear(),this.disableButtons(),this.canvas.style.cursor="default"}},{key:"ngOnDestroy",value:function(){this.removeEventListeners()}}]),e}(k),b=((r=function(t){function e(t,n){var i;return _classCallCheck(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).draw=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.ctx;return function(n){t.save(),n.snakes.forEach((function(n,s){n.isAlive()&&(t.strokeStyle=e.SNAKE_COLORS[s],i.drawSnake(t,n))})),t.restore()}},i.drawSnakeSegment=function(t){return function(e){t.save(),t.lineWidth=Math.min(i.x(1),i.y(1)),t.lineCap="round",t.lineJoin="round";var n=e.shift();t.moveTo(i.x(n.x)+i.x(1)/2,i.y(n.y)+i.y(1)/2),t.beginPath(),t.lineTo(i.x(n.x)+i.x(1)/2,i.y(n.y)+i.y(1)/2),e.forEach((function(e){t.lineTo(i.x(e.x)+i.x(1)/2,i.y(e.y)+i.y(1)/2)})),t.stroke(),t.restore()}},i}return _inherits(e,t),_createClass(e,[{key:"drawSnake",value:function(t,e){e.segments().forEach(this.drawSnakeSegment(t)),this.drawSnakeHead(t,e)}},{key:"drawSnakeHead",value:function(t,e){t.save();var n=e.snake[0];t.translate(this.x(n.x)+this.x(1)/2,this.y(n.y)+this.y(1)/2),t.rotate(Math.PI/180*e.direction());var i=0+3*this.x(1)/16,s=3*this.y(1)/16;t.fillStyle="white";var r=Math.min(this.x(1),this.y(1))/8;t.beginPath(),t.arc(i,0-s,r,0,2*Math.PI),t.arc(i,0+s,r,0,2*Math.PI),t.fill(),t.fillStyle="black",r/=2,t.beginPath(),t.arc(i+r,0-s,r,0,2*Math.PI),t.arc(i+r,0+s,r,0,2*Math.PI),t.fill(),t.restore()}}]),e}(k)).SNAKE_COLORS=["#00c832","#c7c700"],r),C=((s=function(t){function e(t,n){var i;return _classCallCheck(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).draw=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.ctx;i.clear(),i.snakeAnimator.draw()(t),i.drawApple(e)(t),t.isCrash()&&i.drawCrash(e)},i.drawApple=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.ctx;return function(n){t.fillStyle=e.APPLE_COLOR,w.drawRoundedRect(t,i.x(n.apple.x),i.y(n.apple.y),i.x(1),i.y(1))}},i.snakeAnimator=new b(t,n),i}return _inherits(e,t),_createClass(e,[{key:"drawCrash",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ctx;t.fillStyle=e.CRASH_COLOR,t.fillRect(0,0,this.canvas.width,this.canvas.height)}}]),e}(k)).APPLE_COLOR="#ff3200",s.CRASH_COLOR="rgb(255,0,0)",s),_=function(){function t(e,n,i){var s=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g(!0);_classCallCheck(this,t),this.state=r,this.fps=10,this.paused=!1,this.update=function(t){return function(e){e-t>1e3/s.fps?(s.paused?s.pauseMenuAnimator.draw():(s.state=s.state.next(),s.gameAnimator.draw(s.state)),s.animationFrameId=window.requestAnimationFrame(s.update(e))):s.animationFrameId=window.requestAnimationFrame(s.update(t))}},this.gameAnimator=new C(e,r),this.pauseMenuAnimator=new m(i,r,(function(){return s.pause()}),(function(){return s.toggleTwoPlayers()})),this.backgroundAnimator=new p(n,r)}return _createClass(t,[{key:"start",value:function(){this.backgroundAnimator.draw(),this.gameAnimator.draw(this.state),this.pause(),this.animationFrameId=window.requestAnimationFrame(this.update(0))}},{key:"ngOnDestroy",value:function(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.pauseMenuAnimator.ngOnDestroy())}},{key:"keyEvent",value:function(t){switch(t){case" ":return this.pause(),!0;case"w":return this.state=this.state.enqueue(0,f.NORTH),!0;case"a":return this.state=this.state.enqueue(0,f.WEST),!0;case"s":return this.state=this.state.enqueue(0,f.SOUTH),!0;case"d":return this.state=this.state.enqueue(0,f.EAST),!0;case"i":case"ArrowUp":return this.state=this.state.enqueue(1,f.NORTH),!0;case"j":case"ArrowLeft":return this.state=this.state.enqueue(1,f.WEST),!0;case"k":case"ArrowDown":return this.state=this.state.enqueue(1,f.SOUTH),!0;case"l":case"ArrowRight":return this.state=this.state.enqueue(1,f.EAST),!0}return!1}},{key:"pause",value:function(){(this.paused=!this.paused)?this.pauseMenuAnimator.show():this.pauseMenuAnimator.hide()}},{key:"toggleTwoPlayers",value:function(){this.gameAnimator.draw(this.state=new g(!this.state.isTwoPlayers))}}]),t}(),x=((a=function(){function t(){_classCallCheck(this,t),this._highScore=0}return _createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.scaleCanvas(),this.animator=new _(document.getElementById("game-layer"),document.getElementById("background-layer"),document.getElementById("ui-layer")),window.addEventListener("keydown",(function(t){e.animator.keyEvent(t.key)&&t.preventDefault()})),this.animator.start(),this.highScore=+h.getCookie(t.COOKIE_NAME)}},{key:"ngOnDestroy",value:function(){this.animator.ngOnDestroy()}},{key:"scaleCanvas",value:function(t){var e=document.getElementById("menu"),n=document.getElementById("main"),i=document.getElementById("stage"),s=document.getElementById("background-layer"),r=(window.innerHeight-e.offsetHeight-10)/s.height,a=n.offsetWidth/s.width,o=Math.min(a,r);Math.max(a,r),i.style.transformOrigin="0 0",i.style.transform="scale("+o+")"}},{key:"score",get:function(){return Math.max.apply(Math,_toConsumableArray(this.animator.state.snakes.map((function(t){return t.snake.length}))))},set:function(t){}},{key:"highScore",get:function(){return this.score>this._highScore&&(this._highScore=this.score,h.setCookie(t.COOKIE_NAME,this._highScore,90)),this._highScore},set:function(t){this._highScore=t}}]),t}()).COOKIE_NAME="snake-high-score",a),S=o.vb({encapsulation:0,styles:[["#stage[_ngcontent-%COMP%]{width:900px;height:900px;position:relative;box-sizing:content-box;border:1px solid;background-color:#fff}#stage[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute}#stage[_ngcontent-%COMP%]   #ui-layer[_ngcontent-%COMP%]{z-index:3}#stage[_ngcontent-%COMP%]   #game-layer[_ngcontent-%COMP%]{z-index:2}#stage[_ngcontent-%COMP%]   #background-layer[_ngcontent-%COMP%]{z-index:1}"]],data:{}});function O(t){return o.Tb(0,[(t()(),o.xb(0,0,null,null,3,"div",[["id","stage"]],null,null,null,null,null)),(t()(),o.xb(1,0,null,null,0,"canvas",[["height","900"],["id","ui-layer"],["width","900"]],null,null,null,null,null)),(t()(),o.xb(2,0,null,null,0,"canvas",[["height","900"],["id","game-layer"],["width","900"]],null,null,null,null,null)),(t()(),o.xb(3,0,null,null,0,"canvas",[["height","900"],["id","background-layer"],["width","900"]],null,null,null,null,null))],null,null)}var E=o.tb("app-snake",x,(function(t){return o.Tb(0,[(t()(),o.xb(0,0,null,null,1,"app-snake",[],null,[["window","resize"]],(function(t,e,n){var i=!0;return"window:resize"===e&&(i=!1!==o.Jb(t,1).scaleCanvas(n)&&i),i}),O,S)),o.wb(1,245760,null,0,x,[],null,null)],(function(t,e){t(e,1,0)}),null)}),{},{},[]),A=n("SVse"),P=n("s7LF"),T=n("iInd"),M=function t(){_classCallCheck(this,t)};n.d(e,"SnakeModuleNgFactory",(function(){return R}));var R=o.ub(u,[],(function(t){return o.Gb([o.Hb(512,o.l,o.fb,[[8,[l.a,E]],[3,o.l],o.B]),o.Hb(4608,A.o,A.n,[o.x,[2,A.D]]),o.Hb(4608,P.o,P.o,[]),o.Hb(1073742336,A.b,A.b,[]),o.Hb(1073742336,T.o,T.o,[[2,T.t],[2,T.k]]),o.Hb(1073742336,M,M,[]),o.Hb(1073742336,P.n,P.n,[]),o.Hb(1073742336,P.d,P.d,[]),o.Hb(1073742336,u,u,[]),o.Hb(1024,T.i,(function(){return[[{path:"",component:x}]]}),[])])}))}}]);