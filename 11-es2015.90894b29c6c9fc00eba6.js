(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ElCL:function(t,e,s){"use strict";s.r(e);var n=s("8Y7J");class i{}var a=s("pMnS");class r{static setCookie(t,e,s){const n=new Date;n.setTime(n.getTime()+24*s*60*60*1e3);const i="expires="+n.toUTCString();document.cookie=t+"="+e+";"+i+";path=/"}static getCookie(t){const e=t+"=",s=decodeURIComponent(document.cookie).split(";");for(let n=0;n<s.length;n++){let t=s[n];for(;" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length)}return""}}class h{constructor(t,e){this.x=t,this.y=e}equals(t){return null!=t&&this.x===t.x&&this.y===t.y}squaredDistance(t){return Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)}distance(t){return Math.sqrt(this.squaredDistance(t))}}let o=(()=>{class t{constructor(){}}return t.NORTH=new h(0,-1),t.SOUTH=new h(0,1),t.EAST=new h(1,0),t.WEST=new h(-1,0),t})();const l=(t,e)=>Math.floor(Math.random()*e)+t,u=t=>e=>(e%t+t)%t;class c{constructor(t,e,s,n,i,a=[]){this.cols=t,this.rows=e,this.moves=s,this.start=n,this.apple=i,this.snake=a}willEat(){return this.nextHead().equals(this.apple)}inSnake(t){return this.snake.some(e=>e.equals(t))}willCrash(t){const e=this.nextHead();return this.inSnake(e)||t&&(t.inSnake(e)||this.snake[0]&&this.snake[0].equals(t.snake[0]))}validMove(t){return this.moves[0].x+t.x!==0||this.moves[0].y+t.y!==0}nextMoves(){return this.moves.length>1?this.moves.slice(1):this.moves}nextHead(){return 0===this.snake.length?this.start:new h(u(this.cols)(this.snake[0].x+this.moves[0].x),u(this.rows)(this.snake[0].y+this.moves[0].y))}nextSnake(t){return this.willCrash(t)?[]:this.willEat()?[this.nextHead()].concat(this.snake):[this.nextHead()].concat(this.snake.slice(0,this.snake.length-1))}merge(t){return Object.assign(new c(this.cols,this.rows,this.moves,this.start,this.apple,this.snake),t)}next(t,e,s,n){return new c(t,e,this.nextMoves(),this.start,s,this.nextSnake(n))}enqueue(t){return this.validMove(t)?this.merge({moves:this.moves.concat([t])}):this}direction(){const t=this.moves[0];return t.equals(o.NORTH)?270:t.equals(o.SOUTH)?90:t.equals(o.EAST)?0:t.equals(o.WEST)?180:null}segments(){return this.snake.reduce((t,e)=>{if(0===t.length)t.push([e]);else{const s=t[t.length-1];1===e.distance(s[s.length-1])?s.push(e):t.push([e])}return t},[])}isAlive(){return this.snake.length>0}}class d{constructor(t=!1,e=24,s=24,n=[],i=new h(20,2)){this.isTwoPlayers=t,this.cols=e,this.rows=s,this.snakes=n,this.apple=i,0===this.snakes.length&&(this.snakes=[this.snakeFromState(o.EAST,new h(2,2))],this.isTwoPlayers&&this.snakes.push(this.snakeFromState(o.NORTH,new h(20,20))))}snakeFromState(t,e){return new c(this.cols,this.rows,[t],e,this.apple,[e])}isCrash(){return this.snakes.reduce((t,e)=>t||!e.isAlive(),!1)}willEat(){return this.snakes.reduce((t,e)=>t||e.willEat(),!1)}nextApple(){if(this.willEat()){let t;do{t=this.snakes.reduce((t,e)=>e.inSnake(t)?null:t,this.rndPos())}while(!t);return t}return this.apple}nextSnakes(){return this.snakes.map((t,e,s)=>t.next(this.cols,this.rows,this.apple,s.length>1?s[(e+1)%s.length]:null))}rndPos(){return new h(l(0,this.cols-1),l(0,this.rows-1))}merge(t){return Object.assign(new d,this,t)}next(){return new d(this.isTwoPlayers,this.cols,this.rows,this.nextSnakes(),this.nextApple())}enqueue(t,e){return t%=this.snakes.length,this.merge({snakes:this.snakes.map((s,n)=>n===t?this.snakes[t].enqueue(e):s)})}}class g{constructor(t,e){this.canvas=t,this.grid=e,this.ctx=t.getContext("2d")}clear(t=this.ctx){t.clearRect(0,0,this.canvas.width,this.canvas.height)}x(t){return Math.round(t*this.canvas.width/this.grid.cols)}y(t){return Math.round(t*this.canvas.height/this.grid.rows)}}let w=(()=>{class t extends g{constructor(e,s){super(e,s),this.draw=(e=this.ctx)=>{e.save(),e.fillStyle=t.BACKGROUND_COLOR,e.fillRect(0,0,this.canvas.width,this.canvas.height),e.restore()}}}return t.BACKGROUND_COLOR="#232323",t})(),m=(()=>{class t{static drawRoundedRect(t,e,s,n,i,a=10,r=!0,h=!1){if("number"==typeof a)a={tl:a,tr:a,br:a,bl:a};else{const t={tl:0,tr:0,br:0,bl:0};for(const e of Object.keys(t))a[e]=a[e]||t[e]}t.save(),t.beginPath(),t.moveTo(e+a.tl,s),t.lineTo(e+n-a.tr,s),t.quadraticCurveTo(e+n,s,e+n,s+a.tr),t.lineTo(e+n,s+i-a.br),t.quadraticCurveTo(e+n,s+i,e+n-a.br,s+i),t.lineTo(e+a.bl,s+i),t.quadraticCurveTo(e,s+i,e,s+i-a.bl),t.lineTo(e,s+a.tl),t.quadraticCurveTo(e,s,e+a.tl,s),t.closePath(),r&&t.fill(),h&&t.stroke(),t.restore()}}return t.drawButton=e=>({x:s,y:n,width:i,height:a,radius:r,fillStyle:h,strokeStyle:o,hoverStyle:l,text:u,fontSize:c,textStyle:d,state:g})=>{e.save(),"hover"===g&&l?e.fillStyle=l:h&&(e.fillStyle=h),o&&(e.lineWidth=2,e.strokeStyle=o),t.drawRoundedRect(e,s,n,i,a,r,!0,null!=o),t.drawText(e,u,s+i/2,n+a/2,c,d),e.restore()},t.drawText=(e,s,n,i,a,r,h="center",o="middle")=>{e.save(),e.fillStyle=r,e.font=t.getFont(a),e.textAlign=h,e.textBaseline=o,e.fillText(s,n,i),e.restore()},t.getFont=t=>t+'px Montserrat, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',t.addButtonClickEventListener=(e,s)=>{const n=t.getMousePos(e),i=e=>{const i=n(e);s.forEach(s=>{s.enabled&&t.isIntersect(i,s)&&s.onClick(e)})};return e.addEventListener("click",i),{type:"click",function:i}},t.addButtonHoverEventListener=(e,s)=>{const n=t.getMousePos(e),i=i=>{const a=n(i);let r=!1;s.forEach(e=>{e.enabled&&t.isIntersect(a,e)?(e.state="hover",r=!0):e.state&&(e.state=void 0)}),e.style.cursor=r?"pointer":"default"};return e.addEventListener("mousemove",i),{type:"mousemove",function:i}},t.getMousePos=t=>e=>{const s=t.getBoundingClientRect();return{x:(e.clientX-s.left)/(s.right-s.left)*t.width,y:(e.clientY-s.top)/(s.bottom-s.top)*t.height}},t.isIntersect=(t,e)=>t.x>e.x&&t.x<e.x+e.width&&t.y<e.y+e.height&&t.y>e.y,t})();class y extends g{constructor(t,e,s,n){super(t,e),this.buttons=[],this.eventListeners=[],this.draw=(t=this.ctx)=>{this.clear(),t.save(),this.buttons.forEach(m.drawButton(t)),t.restore()};const i=t.width/4,a=t.height/8,r=t.width/2-i/2,h=t.height/2-a/2;this.buttons.push({x:r,y:h,width:i,height:a,radius:5,fillStyle:"#005FA1",hoverStyle:"#00487b",text:"Paused",fontSize:this.y(1),textStyle:"white",enabled:!0,onClick:()=>{s()}},{x:r,y:h+2*a,width:i,height:a,radius:5,fillStyle:"#005fa1",hoverStyle:"#00487b",text:"Two Players",fontSize:.8*this.y(1),textStyle:"rgba(255, 255, 255, 1)",enabled:!0,onClick:()=>{n()}}),this.addEventListeners()}addEventListeners(t=this.canvas,e=this.buttons){return this.eventListeners.push(m.addButtonClickEventListener(t,e),m.addButtonHoverEventListener(t,e))}removeEventListeners(t=this.canvas,e=this.eventListeners){e.forEach(e=>{t.removeEventListener(e.type,e.function)})}enableButtons(t=this.buttons){t.forEach(t=>t.enabled=!0)}disableButtons(t=this.buttons){t.forEach(t=>t.enabled=!1)}show(){this.enableButtons(),this.draw()}hide(){this.clear(),this.disableButtons(),this.canvas.style.cursor="default"}ngOnDestroy(){this.removeEventListeners()}}let p=(()=>{class t extends g{constructor(e,s){super(e,s),this.draw=(e=this.ctx)=>s=>{e.save(),s.snakes.forEach((s,n)=>{s.isAlive()&&(e.strokeStyle=t.SNAKE_COLORS[n],this.drawSnake(e,s))}),e.restore()},this.drawSnakeSegment=t=>e=>{t.save(),t.lineWidth=Math.min(this.x(1),this.y(1)),t.lineCap="round",t.lineJoin="round";const s=e.shift();t.moveTo(this.x(s.x)+this.x(1)/2,this.y(s.y)+this.y(1)/2),t.beginPath(),t.lineTo(this.x(s.x)+this.x(1)/2,this.y(s.y)+this.y(1)/2),e.forEach(e=>{t.lineTo(this.x(e.x)+this.x(1)/2,this.y(e.y)+this.y(1)/2)}),t.stroke(),t.restore()}}drawSnake(t,e){e.segments().forEach(this.drawSnakeSegment(t)),this.drawSnakeHead(t,e)}drawSnakeHead(t,e){t.save();const s=e.snake[0];t.translate(this.x(s.x)+this.x(1)/2,this.y(s.y)+this.y(1)/2),t.rotate(Math.PI/180*e.direction());const n=0+3*this.x(1)/16,i=3*this.y(1)/16;t.fillStyle="white";let a=Math.min(this.x(1),this.y(1))/8;t.beginPath(),t.arc(n,0-i,a,0,2*Math.PI),t.arc(n,0+i,a,0,2*Math.PI),t.fill(),t.fillStyle="black",a/=2,t.beginPath(),t.arc(n+a,0-i,a,0,2*Math.PI),t.arc(n+a,0+i,a,0,2*Math.PI),t.fill(),t.restore()}}return t.SNAKE_COLORS=["#00c832","#c7c700"],t})(),x=(()=>{class t extends g{constructor(e,s){super(e,s),this.draw=(t,e=this.ctx)=>{this.clear(),this.snakeAnimator.draw()(t),this.drawApple(e)(t),t.isCrash()&&this.drawCrash(e)},this.drawApple=(e=this.ctx)=>s=>{e.fillStyle=t.APPLE_COLOR,m.drawRoundedRect(e,this.x(s.apple.x),this.y(s.apple.y),this.x(1),this.y(1))},this.snakeAnimator=new p(e,s)}drawCrash(e=this.ctx){e.fillStyle=t.CRASH_COLOR,e.fillRect(0,0,this.canvas.width,this.canvas.height)}}return t.APPLE_COLOR="#ff3200",t.CRASH_COLOR="rgb(255,0,0)",t})();class v{constructor(t,e,s,n=new d(!0)){this.state=n,this.fps=10,this.paused=!1,this.update=t=>e=>{e-t>1e3/this.fps?(this.paused?this.pauseMenuAnimator.draw():(this.state=this.state.next(),this.gameAnimator.draw(this.state)),this.animationFrameId=window.requestAnimationFrame(this.update(e))):this.animationFrameId=window.requestAnimationFrame(this.update(t))},this.gameAnimator=new x(t,n),this.pauseMenuAnimator=new y(s,n,()=>this.pause(),()=>this.toggleTwoPlayers()),this.backgroundAnimator=new w(e,n)}start(){this.backgroundAnimator.draw(),this.gameAnimator.draw(this.state),this.pause(),this.animationFrameId=window.requestAnimationFrame(this.update(0))}ngOnDestroy(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.pauseMenuAnimator.ngOnDestroy())}keyEvent(t){switch(t){case" ":return this.pause(),!0;case"w":return this.state=this.state.enqueue(0,o.NORTH),!0;case"a":return this.state=this.state.enqueue(0,o.WEST),!0;case"s":return this.state=this.state.enqueue(0,o.SOUTH),!0;case"d":return this.state=this.state.enqueue(0,o.EAST),!0;case"i":case"ArrowUp":return this.state=this.state.enqueue(1,o.NORTH),!0;case"j":case"ArrowLeft":return this.state=this.state.enqueue(1,o.WEST),!0;case"k":case"ArrowDown":return this.state=this.state.enqueue(1,o.SOUTH),!0;case"l":case"ArrowRight":return this.state=this.state.enqueue(1,o.EAST),!0}return!1}pause(){(this.paused=!this.paused)?this.pauseMenuAnimator.show():this.pauseMenuAnimator.hide()}toggleTwoPlayers(){this.gameAnimator.draw(this.state=new d(!this.state.isTwoPlayers))}}let k=(()=>{class t{constructor(){this._highScore=0}ngOnInit(){this.scaleCanvas(),this.animator=new v(document.getElementById("game-layer"),document.getElementById("background-layer"),document.getElementById("ui-layer")),window.addEventListener("keydown",t=>{this.animator.keyEvent(t.key)&&t.preventDefault()}),this.animator.start(),this.highScore=+r.getCookie(t.COOKIE_NAME)}ngOnDestroy(){this.animator.ngOnDestroy()}get score(){return Math.max(...this.animator.state.snakes.map(t=>t.snake.length))}set score(t){}get highScore(){return this.score>this._highScore&&(this._highScore=this.score,r.setCookie(t.COOKIE_NAME,this._highScore,90)),this._highScore}set highScore(t){this._highScore=t}scaleCanvas(t){const e=document.getElementById("menu"),s=document.getElementById("main"),n=document.getElementById("stage"),i=document.getElementById("background-layer"),a=(window.innerHeight-e.offsetHeight-10)/i.height,r=s.offsetWidth/i.width,h=Math.min(r,a);Math.max(r,a),n.style.transformOrigin="0 0",n.style.transform="scale("+h+")"}}return t.COOKIE_NAME="snake-high-score",t})();var b=n.vb({encapsulation:0,styles:[["#stage[_ngcontent-%COMP%]{width:900px;height:900px;position:relative;box-sizing:content-box;border:1px solid;background-color:#fff}#stage[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute}#stage[_ngcontent-%COMP%]   #ui-layer[_ngcontent-%COMP%]{z-index:3}#stage[_ngcontent-%COMP%]   #game-layer[_ngcontent-%COMP%]{z-index:2}#stage[_ngcontent-%COMP%]   #background-layer[_ngcontent-%COMP%]{z-index:1}"]],data:{}});function S(t){return n.Tb(0,[(t()(),n.xb(0,0,null,null,3,"div",[["id","stage"]],null,null,null,null,null)),(t()(),n.xb(1,0,null,null,0,"canvas",[["height","900"],["id","ui-layer"],["width","900"]],null,null,null,null,null)),(t()(),n.xb(2,0,null,null,0,"canvas",[["height","900"],["id","game-layer"],["width","900"]],null,null,null,null,null)),(t()(),n.xb(3,0,null,null,0,"canvas",[["height","900"],["id","background-layer"],["width","900"]],null,null,null,null,null))],null,null)}function f(t){return n.Tb(0,[(t()(),n.xb(0,0,null,null,1,"app-snake",[],null,[["window","resize"]],(function(t,e,s){var i=!0;return"window:resize"===e&&(i=!1!==n.Jb(t,1).scaleCanvas(s)&&i),i}),S,b)),n.wb(1,245760,null,0,k,[],null,null)],(function(t,e){t(e,1,0)}),null)}var E=n.tb("app-snake",k,f,{},{},[]),C=s("SVse"),O=s("s7LF"),A=s("iInd");class M{}s.d(e,"SnakeModuleNgFactory",(function(){return T}));var T=n.ub(i,[],(function(t){return n.Gb([n.Hb(512,n.l,n.fb,[[8,[a.a,E]],[3,n.l],n.B]),n.Hb(4608,C.o,C.n,[n.x,[2,C.D]]),n.Hb(4608,O.o,O.o,[]),n.Hb(1073742336,C.b,C.b,[]),n.Hb(1073742336,A.o,A.o,[[2,A.t],[2,A.k]]),n.Hb(1073742336,M,M,[]),n.Hb(1073742336,O.n,O.n,[]),n.Hb(1073742336,O.d,O.d,[]),n.Hb(1073742336,i,i,[]),n.Hb(1024,A.i,(function(){return[[{path:"",component:k}]]}),[])])}))}}]);